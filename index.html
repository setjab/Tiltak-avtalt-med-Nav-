<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>Tiltak avtalt med Nav</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin:20px; background:#f4f6f9; color:#222; }
    header {
      background: linear-gradient(90deg, #14532d, #228B22, #b8860b);
      color: #fff; padding: 30px; text-align: center; font-size: 32px; font-weight: 900;
      border-radius: 14px; margin-bottom: 20px; box-shadow: 0 4px 16px rgba(0,0,0,0.25);
    }
    header span { display:block; font-size:18px; margin-top:10px; font-weight:600; }

    .dashboard { display:flex; gap:40px; justify-content:center; margin-bottom:40px; }
    .card {
      flex:1; background:#fff; border-radius:12px; padding:20px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1); text-align:center;
    }
    .card h3 { margin:0; font-size:22px; }
    .card .number { font-size:40px; font-weight:bold; margin:10px 0; }
    .card.green { border-top:6px solid #4caf50; }
    .card.yellow { border-top:6px solid #ffc107; }
    .card .date { font-size:13px; color:#777; }

    table { width:100%; border-collapse:collapse; margin-bottom:20px; background:#fff;
      box-shadow:0 2px 6px rgba(0,0,0,0.1); border-radius:10px; overflow:hidden; }
    th, td { padding:10px; text-align:center; border-bottom:1px solid #eee; }
    th { background:#228B22; color:white; }
    input { width:70px; padding:4px; text-align:center; }

    #charts { display:flex; flex-direction:column; gap:50px; }
    canvas { background:#fff; padding:30px; border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.15); }

    .export-btn {
      padding:12px 20px; background:#14532d; color:#fff; border:none; border-radius:6px;
      cursor:pointer; margin:20px auto; display:block; font-size:16px; font-weight:600;
    }
    footer { margin-top:18px; font-size:13px; color:#666; text-align:center; }
  </style>
</head>
<body>

<header>‚≠ê Tiltak avtalt med Nav ‚≠ê<br>
<span>‚úÖ Utviklet av Settar Al-Jabri ‚úÖ</span></header>

<div class="dashboard">
  <div class="card green">
    <h3>Totalt registrert <br>Under 30 √•r</h3>
    <div class="number" id="dashUnder30">0</div>
    <div class="date" id="dateU30"></div>
  </div>
  <div class="card yellow">
    <h3>Totalt registrert <br>Over 30 √•r</h3>
    <div class="number" id="dashOver30">0</div>
    <div class="date" id="dateO30"></div>
  </div>
</div>

<h3>Registrer antall per tiltak</h3>
<label>Totalt under 30 √•r:
  <input type="number" id="totalUnder30" value="0" onchange="renderTable()">
</label>
<br><br>
<label>Totalt over 30 √•r:
  <input type="number" id="totalOver30" value="0" onchange="renderTable()">
</label>

<table>
  <thead>
    <tr>
      <th>Tiltak</th>
      <th>Under 30 √•r</th>
      <th>Over 30 √•r</th>
    </tr>
  </thead>
  <tbody id="tiltakTable"></tbody>
</table>

<div id="charts">
  <canvas id="chartUnder30" width="1200" height="600"></canvas>
  <canvas id="chartOver30" width="1200" height="600"></canvas>
</div>

<button class="export-btn" onclick="exportPDF()">üìÑ Last ned PDF</button>

<footer>Utviklet av Settar Al-Jabri</footer>

<script>
const tiltak = [
  "Arbeid med st√∏tte",
  "Arbeidsforberedende trening (AFT)",
  "Arbeidsrettet rehabilitering (dag)",
  "Arbeidstrening",
  "Avklaring",
  "Enkeltplass AMO",
  "Enkeltplass Fag- og yrkesoppl√¶ring VGS og h√∏yere yrkesfaglig utdanning",
  "Fors√∏k AMO enkeltplass",
  "Gruppe AMO",
  "H√∏yere utdanning",
  "Midlertidig l√∏nnstilskudd",
  "Oppf√∏lging",
  "Varig l√∏nnstilskudd",
  "Varig tilrettelagt arbeid i ordin√¶r virksomhet",
  "Varig tilrettelagt arbeid i skjermet virksomhet"
];

let data = {};
tiltak.forEach(t => data[t] = {under30:0, over30:0});

// Farger
const colors = [
  "#4caf50","#2196f3","#ff9800","#9c27b0","#f44336","#3f51b5","#009688",
  "#cddc39","#ff5722","#795548","#673ab7","#8bc34a","#607d8b","#e91e63","#ffc107"
];

function renderTable(){
  const tbody=document.getElementById("tiltakTable");
  tbody.innerHTML="";
  tiltak.forEach((t,i)=>{
    const row=document.createElement("tr");
    row.innerHTML=`
      <td>${t}</td>
      <td><input type="number" min="0" value="${data[t].under30}" onchange="updateData('${t}','under30',this.value)"></td>
      <td><input type="number" min="0" value="${data[t].over30}" onchange="updateData('${t}','over30',this.value)"></td>
    `;
    tbody.appendChild(row);
  });
  updateCharts();
}

function updateData(t,f,val){
  data[t][f]=parseInt(val)||0;
  updateCharts();
}

function updateCharts(){
  const totalU=parseInt(document.getElementById("totalUnder30").value)||0;
  const totalO=parseInt(document.getElementById("totalOver30").value)||0;

  let usedU=0, usedO=0;
  const labels=[...tiltak];
  const under30=[], over30=[];

  tiltak.forEach((t,i)=>{
    under30.push(data[t].under30);
    over30.push(data[t].over30);
    usedU+=data[t].under30;
    usedO+=data[t].over30;
  });

  // Oppdater dashboard
  document.getElementById("dashUnder30").innerText = totalU;
  document.getElementById("dashOver30").innerText = totalO;
  const now=new Date().toLocaleString("no-NO");
  document.getElementById("dateU30").innerText = "Oppdatert: " + now;
  document.getElementById("dateO30").innerText = "Oppdatert: " + now;

  // Grafer (kun tiltak)
  if(window.chartU) window.chartU.destroy();
  if(window.chartO) window.chartO.destroy();

  window.chartU=new Chart(document.getElementById("chartUnder30").getContext("2d"),{
    type:'bar',
    data:{labels:labels,datasets:[{label:"Under 30 √•r",data:under30,backgroundColor:colors}]},
    options:{
      responsive:false,
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true, suggestedMax:50, ticks:{stepSize:5}}}
    }
  });

  window.chartO=new Chart(document.getElementById("chartOver30").getContext("2d"),{
    type:'bar',
    data:{labels:labels,datasets:[{label:"Over 30 √•r",data:over30,backgroundColor:colors}]},
    options:{
      responsive:false,
      plugins:{legend:{display:false}},
      scales:{y:{beginAtZero:true, suggestedMax:50, ticks:{stepSize:5}}}
    }
  });
}

async function exportPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("p","mm","a4");
  const pdfWidth=pdf.internal.pageSize.getWidth();
  const marginTop=25; // plass til header
  const now=new Date().toLocaleString("no-NO");
  let page=1;

  function addHeader(){
    pdf.setFontSize(12);
    pdf.text("‚≠ê Tiltak avtalt med Nav ‚≠ê", pdfWidth/2, 10, {align:"center"});
    pdf.setFontSize(9);
    pdf.text(`Utviklet av Settar Al-Jabri ‚Äì Generert: ${now}`, pdfWidth/2, 16, {align:"center"});
    pdf.text(`Side ${page}`, pdfWidth-20, 16, {align:"right"});
    page++;
  }

  // Side 1: dashboard
  const element1=document.querySelector(".dashboard");
  const canvas1=await html2canvas(element1,{scale:2});
  const img1=canvas1.toDataURL("image/png");
  let pdfHeight=(canvas1.height*pdfWidth)/canvas1.width;
  addHeader();
  pdf.addImage(img1,"PNG",0,marginTop,pdfWidth,pdfHeight);

  // Tabell p√• side 2
  const element2=document.querySelector("table");
  const canvas2=await html2canvas(element2,{scale:2});
  const img2=canvas2.toDataURL("image/png");
  pdfHeight=(canvas2.height*pdfWidth)/canvas2.width;
  pdf.addPage();
  addHeader();
  pdf.addImage(img2,"PNG",0,marginTop,pdfWidth,pdfHeight);

  // Under 30 graf p√• side 3
  const chartU=document.getElementById("chartUnder30");
  const canvasU=await html2canvas(chartU,{scale:2});
  const imgU=canvasU.toDataURL("image/png");
  pdfHeight=(canvasU.height*pdfWidth)/canvasU.width;
  pdf.addPage();
  addHeader();
  pdf.addImage(imgU,"PNG",0,marginTop,pdfWidth,pdfHeight);

  // Over 30 graf p√• side 4
  const chartO=document.getElementById("chartOver30");
  const canvasO=await html2canvas(chartO,{scale:2});
  const imgO=canvasO.toDataURL("image/png");
  pdfHeight=(canvasO.height*pdfWidth)/canvasO.width;
  pdf.addPage();
  addHeader();
  pdf.addImage(imgO,"PNG",0,marginTop,pdfWidth,pdfHeight);

  pdf.save("tiltak.pdf");
}

renderTable();
</script>
</body>
</html>
