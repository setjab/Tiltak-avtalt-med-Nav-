<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>Tiltak avtalt med Nav - Forbedret visuell</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  
  <style>
    /* Reset and base */
    *, *::before, *::after { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #eaf2f7;
      margin: 0; padding: 20px;
      color: #2c3e50;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    h1, h3 {
      font-weight: 700;
      color: #14532d;
      margin-bottom: 8px;
    }
    h3 { font-size: 1.4rem; }
    
    header {
      background: linear-gradient(90deg, #14532d, #228B22, #b8860b);
      padding: 25px 10px;
      border-radius: 15px;
      text-align: center;
      color: white;
      font-size: 2.25rem;
      font-weight: 900;
      box-shadow: 0 6px 15px rgba(20,83,45,0.6);
      user-select: none;
    }
    header span {
      margin-top: 8px;
      display: block;
      font-weight: 600;
      font-size: 1rem;
      opacity: 0.85;
    }
    
    /* Dashboard cards */
    .dashboard {
      display: flex;
      gap: 30px;
      max-width: 900px;
      margin: 30px auto;
      justify-content: center;
      flex-wrap: wrap;
    }
    .card {
      background: white;
      border-radius: 14px;
      padding: 30px 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
      flex: 1 1 380px;
      text-align: center;
      transition: transform 0.3s ease;
      cursor: default;
    }
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 14px 30px rgba(0,0,0,0.15);
    }
    .card h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
      line-height: 1.3;
    }
    .card .number {
      font-size: 3.5rem;
      font-weight: 900;
      color: #14532d;
      margin-bottom: 10px;
      letter-spacing: -0.03em;
    }
    .card.green {
      border-left: 8px solid #4caf50;
    }
    .card.yellow {
      border-left: 8px solid #f1c40f;
      color: #7a6f00;
    }
    .card .date {
      font-size: 0.9rem;
      color: #777;
      font-style: italic;
    }

    /* Input section */
    .input-section {
      max-width: 900px;
      margin: 0 auto 40px;
      background: white;
      border-radius: 14px;
      padding: 25px 30px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.07);
      font-size: 1.1rem;
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }
    .input-section label {
      display: flex;
      flex-direction: column;
      font-weight: 600;
      color: #14532d;
      flex-basis: 200px;
    }
    .input-section input {
      margin-top: 8px;
      padding: 8px 12px;
      font-size: 1rem;
      border-radius: 7px;
      border: 2px solid #ccc;
      transition: border-color 0.3s ease;
      text-align: center;
    }
    .input-section input:focus {
      outline: none;
      border-color: #4caf50;
      box-shadow: 0 0 6px rgba(76,175,80,0.5);
    }

    /* Table styling */
    table {
      width: 100%;
      max-width: 900px;
      margin: 0 auto 40px;
      border-collapse: separate;
      border-spacing: 0 10px;
      font-size: 1rem;
      box-shadow: 0 8px 28px rgba(0,0,0,0.06);
      border-radius: 14px;
      overflow: hidden;
      background: white;
    }
    thead tr {
      background: #228B22;
      color: white;
      font-weight: 700;
      font-size: 1.05rem;
    }
    th, td {
      padding: 14px 12px;
      text-align: center;
    }
    tbody tr {
      background: #fdfdfd;
      border-radius: 14px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.04);
      transition: background-color 0.3s ease;
    }
    tbody tr:hover {
      background: #e1f7d5;
    }
    tbody tr.total-row {
      background: #228B22;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
    }
    tbody tr.total-row:hover {
      background: #1a6b1a;
    }
    tbody td input[type=number] {
      width: 70px;
      font-weight: 600;
      padding: 6px 8px;
      border: 2px solid #ddd;
      border-radius: 8px;
      transition: border-color 0.3s ease;
      text-align: center;
      font-size: 1rem;
    }
    tbody td input[type=number]:focus {
      border-color: #4caf50;
      outline: none;
      box-shadow: 0 0 6px rgba(76,175,80,0.5);
    }

    /* Charts container */
    #charts {
      max-width: 900px;
      margin: 0 auto 50px;
      display: grid;
      gap: 50px;
      grid-template-columns: 1fr;
    }
    .chart-wrapper {
      background: white;
      padding: 25px;
      border-radius: 14px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    canvas {
      max-width: 100%;
      height: 500px !important;
    }

    /* Export button */
    .export-btn {
      background: linear-gradient(90deg, #14532d, #228B22, #b8860b);
      color: white;
      border: none;
      padding: 14px 30px;
      font-size: 1.2rem;
      font-weight: 700;
      border-radius: 14px;
      cursor: pointer;
      display: block;
      margin: 0 auto 40px;
      box-shadow: 0 8px 20px rgba(20,83,45,0.6);
      transition: background 0.4s ease;
      user-select: none;
    }
    .export-btn:hover {
      background: linear-gradient(90deg, #105724, #1b6621, #a67805);
      box-shadow: 0 10px 28px rgba(16,87,36,0.9);
    }
    
    /* Footer styling */
    footer {
      text-align: center;
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 20px;
      user-select: none;
    }

    /* Responsive adjustments */
    @media (min-width: 700px) {
      #charts {
        grid-template-columns: 1fr 1fr;
      }
      .export-btn {
        width: 300px;
      }
    }

  </style>
</head>
<body>

<header>
  ‚≠ê Tiltak avtalt med Nav ‚≠ê
  <span>‚úÖ Utviklet av Settar Al-Jabri ‚úÖ</span>
</header>

<div class="dashboard">
  <div class="card green">
    <h3>Totalt registrert<br>Under 30 √•r</h3>
    <div class="number" id="dashUnder30">0</div>
    <div class="date" id="dateU30"></div>
  </div>
  <div class="card yellow">
    <h3>Totalt registrert<br>Over 30 √•r</h3>
    <div class="number" id="dashOver30">0</div>
    <div class="date" id="dateO30"></div>
  </div>
</div>

<div class="input-section">
  <label>Totalt under 30 √•r:
    <input type="number" id="totalUnder30" value="0" min="0" onchange="renderTable()" />
  </label>
  <label>Totalt over 30 √•r:
    <input type="number" id="totalOver30" value="0" min="0" onchange="renderTable()" />
  </label>
</div>

<table>
  <thead>
    <tr>
      <th>Tiltak</th>
      <th>Under 30 √•r</th>
      <th>Over 30 √•r</th>
    </tr>
  </thead>
  <tbody id="tiltakTable"></tbody>
</table>

<div id="charts">
  <div class="chart-wrapper">
    <canvas id="chartUnder30"></canvas>
  </div>
  <div class="chart-wrapper">
    <canvas id="chartOver30"></canvas>
  </div>
</div>

<button class="export-btn" onclick="exportPDF()">üìÑ Last ned PDF</button>

<footer>Utviklet av Settar Al-Jabri</footer>

<script>
  const tiltak = [
    "Arbeid med st√∏tte",
    "Arbeidsforberedende trening (AFT)",
    "Arbeidstrening",
    "Avklaring",
    "Enkeltplass AMO",
    "Enkeltplass Fag- og yrkesoppl√¶ring VGS og h√∏yere yrkesfaglig utdanning",
    "Fors√∏k AMO enkeltplass",
    "Gruppe AMO",
    "H√∏yere utdanning",
    "Mentor",
    "Midlertidig l√∏nnstilskudd",
    "Oppf√∏lging",
    "Varig l√∏nnstilskudd",
    "Varig tilrettelagt arbeid i ordin√¶r virksomhet",
    "Varig tilrettelagt arbeid i skjermet virksomhet"
  ];

  // Kortere navn for grafer
  const tiltakKort = [
    "Arbeid m/st√∏tte",
    "AFT",
    "Arbeidstrening",
    "Avklaring",
    "Enkeltpl. AMO",
    "Enkeltpl. Fag/VGS",
    "Fors√∏k AMO",
    "Gruppe AMO",
    "H√∏yere utd.",
    "Mentor",
    "Midl. l√∏nnstil.",
    "Oppf√∏lging",
    "Varig l√∏nnstil.",
    "VTA ordin√¶r",
    "VTA skjermet"
  ];

  let data = {};
  tiltak.forEach(t => data[t] = { under30: 0, over30: 0 });

  const colors = [
    "#4caf50", "#2196f3", "#ff9800", "#9c27b0", "#f44336", "#3f51b5", "#009688",
    "#cddc39", "#ff5722", "#795548", "#673ab7", "#8bc34a", "#607d8b", "#e91e63", "#ffc107"
  ];

  function renderTable() {
    const tbody = document.getElementById("tiltakTable");
    tbody.innerHTML = "";
    
    let totalU30 = 0;
    let totalO30 = 0;
    
    tiltak.forEach((t, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${t}</td>
        <td><input type="number" min="0" value="${data[t].under30}" onchange="updateData('${t}', 'under30', this.value)"></td>
        <td><input type="number" min="0" value="${data[t].over30}" onchange="updateData('${t}', 'over30', this.value)"></td>
      `;
      tbody.appendChild(row);
      
      totalU30 += data[t].under30;
      totalO30 += data[t].over30;
    });
    
    // Add total row
    const totalRow = document.createElement("tr");
    totalRow.className = "total-row";
    totalRow.innerHTML = `
      <td><strong>Total</strong></td>
      <td><strong>${totalU30}</strong></td>
      <td><strong>${totalO30}</strong></td>
    `;
    tbody.appendChild(totalRow);
    
    updateCharts();
  }

  function updateData(t, f, val) {
    data[t][f] = parseInt(val) || 0;
    renderTable();
  }

  function updateCharts() {
    const totalU = parseInt(document.getElementById("totalUnder30").value) || 0;
    const totalO = parseInt(document.getElementById("totalOver30").value) || 0;

    let usedU = 0, usedO = 0;
    const labels = [...tiltakKort]; // Bruker korte navn
    const under30 = [], over30 = [];

    tiltak.forEach(t => {
      under30.push(data[t].under30);
      over30.push(data[t].over30);
      usedU += data[t].under30;
      usedO += data[t].over30;
    });

    // Oppdater dashboard
    document.getElementById("dashUnder30").innerText = totalU.toLocaleString();
    document.getElementById("dashOver30").innerText = totalO.toLocaleString();
    const now = new Date().toLocaleString("no-NO");
    document.getElementById("dateU30").innerText = "Oppdatert: " + now;
    document.getElementById("dateO30").innerText = "Oppdatert: " + now;

    // Oppdater grafer (bare tiltak)
    if (window.chartU) window.chartU.destroy();
    if (window.chartO) window.chartO.destroy();

    window.chartU = new Chart(document.getElementById("chartUnder30").getContext("2d"), {
      type: 'bar',
      data: { labels: labels, datasets: [{ label: "Under 30 √•r", data: under30, backgroundColor: colors }] },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { 
          legend: { display: false },
          tooltip: {
            callbacks: {
              title: function(context) {
                return tiltak[context[0].dataIndex];
              }
            }
          }
        },
        scales: { 
          y: { beginAtZero: true, suggestedMax: Math.max(...under30, 50), ticks: { stepSize: 5, font: { size: 12 } } },
          x: { 
            ticks: { 
              font: { size: 11, weight: 'bold' },
              maxRotation: 60,
              minRotation: 60,
              autoSkip: false
            }
          }
        }
      }
    });

    window.chartO = new Chart(document.getElementById("chartOver30").getContext("2d"), {
      type: 'bar',
      data: { labels: labels, datasets: [{ label: "Over 30 √•r", data: over30, backgroundColor: colors }] },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { 
          legend: { display: false },
          tooltip: {
            callbacks: {
              title: function(context) {
                return tilak[context[0].dataIndex];
              }
            }
          }
        },
        scales: { 
          y: { beginAtZero: true, suggestedMax: Math.max(...over30, 50), ticks: { stepSize: 5, font: { size: 12 } } },
          x: { 
            ticks: { 
              font: { size: 11, weight: 'bold' },
              maxRotation: 60,
              minRotation: 60,
              autoSkip: false
            }
          }
        }
      }
    });
  }

  async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "mm", "a4");
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const marginTop = 25;
    const now = new Date().toLocaleString("no-NO");
    let page = 1;

    function addHeader() {
      pdf.setFontSize(12);
      pdf.text("‚≠ê Tiltak avtalt med Nav ‚≠ê", pdfWidth / 2, 10, { align: "center" });
      pdf.setFontSize(9);
      pdf.text(`Utviklet av Settar Al-Jabri ‚Äì Generert: ${now}`, pdfWidth / 2, 16, { align: "center" });
      pdf.text(`Side ${page}`, pdfWidth - 20, 16, { align: "right" });
      page++;
    }

    // Side 1: dashboard
    const element1 = document.querySelector(".dashboard");
    const canvas1 = await html2canvas(element1, { scale: 2 });
    const img1 = canvas1.toDataURL("image/png");
    let pdfHeight = (canvas1.height * pdfWidth) / canvas1.width;
    addHeader();
    pdf.addImage(img1, "PNG", 0, marginTop, pdfWidth, pdfHeight);

    // Tabell p√• side 2
    const element2 = document.querySelector("table");
    const canvas2 = await html2canvas(element2, { scale: 2 });
    const img2 = canvas2.toDataURL("image/png");
    pdf.addPage();
    addHeader();
    pdfHeight = (canvas2.height * pdfWidth) / canvas2.width;
    pdf.addImage(img2, "PNG", 0, marginTop, pdfWidth, pdfHeight);

    // Under 30 graf p√• side 3
    const chartU = document.querySelector("#chartUnder30").closest('.chart-wrapper');
    const canvasU = await html2canvas(chartU, { scale: 2 });
    const imgU = canvasU.toDataURL("image/png");
    pdf.addPage();
    addHeader();
    pdfHeight = (canvasU.height * pdfWidth) / canvasU.width;
    pdf.addImage(imgU, "PNG", 0, marginTop, pdfWidth, pdfHeight);

    // Over 30 graf p√• side 4
    const chartO = document.querySelector("#chartOver30").closest('.chart-wrapper');
    const canvasO = await html2canvas(chartO, { scale: 2 });
    const imgO = canvasO.toDataURL("image/png");
    pdf.addPage();
    addHeader();
    pdfHeight = (canvasO.height * pdfWidth) / canvasO.width;
    pdf.addImage(imgO, "PNG", 0, marginTop, pdfWidth, pdfHeight);

    pdf.save("tiltak.pdf");
  }

  // Init table & charts
  renderTable();
</script>

</body>
</html>
